create user juan@localhost identified by '';
create user emanuel@localhost identified by '';
create user ricardo@localhost identified by '';
create user rodo@localhost identified by '';

grant all privileges on *.* to juan@localhost with grant option;
grant all privileges on *.* to emanuel@localhost with grant option;
grant all privileges on *.* to ricardo@localhost with grant option;
grant all privileges on *.* to rodo@localhost with grant option;

create database proyecto;
use proyecto

//**TABLAS**//
*
create table Representante(idRepresentante int primary key,Nombre varchar(45),
aPaterno varchar(45),Telefono bigint,Email varchar(45),Cargo varchar(45));
**
create table Empresa(idEmpresa int primary key,Id_Representante int,Nombre varchar(45),Pais varchar(45),Direccion varchar(45),
Telefono bigint,Correo varchar(45),Horario varchar(45),
foreign key(Id_Representante)references Representante(idRepresentante) on delete cascade on update cascade);
***
create table Provedor(idProvedor int primary key,id_Empresa int,Nombre varchar(45),aPaterno varchar(45),Cargo varchar(45),
RFC varchar(45),Direccion varchar(45),Celular bigint,Sexo char,Email varchar(45),
foreign key(id_Empresa)references Empresa(idEmpresa)on delete cascade on update cascade);
****
create table Productos(idProductos int primary key,id_Provedor int, Nombre varchar(45),Marca varchar(45),Precio double,Cantidad int,FechaCaducidad date,
foreign key(id_Provedor)references provedor(idProvedor)on delete cascade on update cascade);
*****
create table Clientes(idClientes int primary key, Nombre varchar(45),aPaterno varchar(45),aMaterno varchar(45),
RFC varchar(45),Direccion varchar(45),Telefono bigint,FechaNacimiento date,Sexo char);
******
create table Factura(idFactura int primary key,FechaPago date,TipoPago varchar(45));
*******
create table Ventas(idVentas int primary key,id_Productos int,id_clientes int,id_Factura int,Monto double,FechaVenta date,
foreign key(id_Productos)references Productos(idProductos)on delete cascade on update cascade,
foreign key(id_Clientes)references Clientes(idClientes)on delete cascade on update cascade,
foreign key(id_Factura)references Factura(idFactura)on delete cascade on update cascade);

//**TABLAS DE AUDITORIA**//
*
create table Audi_Representante(id int primary key auto_increment,
NombreAnt varchar(45),aPaternoAnt varchar(45),TelefonoAnt bigint,EmailAnt varchar(45),CargoAnt varchar(45),
NombreNew varchar(45),aPaternoNew varchar(45),TelefonoNew bigint,EmailNew varchar(45),CargoNew varchar(45),
Usuario varchar(45),Modificado datetime,Accion varchar(45),idRepresentante int);
**
create table Audi_Empresa(id int primary key auto_increment,
id_RepresentanteAnt int,NombreAnt varchar(45),PaisAnt varchar(45),DireccionAnt varchar(45),TelefonoAnt bigint,CorreoAnt varchar(45),HorarioAnt varchar(45),
id_RepresentanteNew int,NombreNew varchar(45),PaisNew varchar(45),DireccionNew varchar(45),TelefonoNew bigint,CorreoNew varchar(45),HorarioNew varchar(45),
Usuario varchar(45),Modificado datetime,Accion varchar(45),idEmpresa int);
***
create table Audi_Provedor(id int primary key auto_increment,
id_EmpresaAnt int,NombreAnt varchar(45),aPaternoAnt varchar(45),CargoAnt varchar(45),RfcAnt varchar(45),DireccionAnt varchar(45),CelularAnt bigint,SexoAnt char,EmailAnt varchar(45),
id_EmpresaNew int,NombreNew varchar(45),aPaternoNew varchar(45),CargoNew varchar(45),RfcNew varchar(45),DireccionNew varchar(45),CelularNew bigint,SexoNew char,EmailNew varchar(45),
Usuario varchar(45),Modificado datetime,Accion varchar(45),idProvedor int);	
****
create table Audi_Productos(id int primary key auto_increment,
id_ProvedorAnt int,NombreAnt varchar(45),MarcaAnt varchar(45),PrecioAnt double,CantidadAnt int,FechaCaducidadAnt date,
id_ProvedorNew int,NombreNew varchar(45),MarcaNew varchar(45),PrecioNew double,CantidadNew int,FechaCaducidadNew date,
Usuario varchar(45),Modificado datetime,Accion varchar(45),idProductos int);
*****
create table Audi_Clientes(id int primary key auto_increment,
NombreAnt varchar(45),aPaternoAnt varchar(45),aMaternoAnt varchar(45),RfcAnt varchar(45),DireccionAnt varchar(45),TelefonoAnt bigint,FechaNacimientoAnt date,SexoAnt char,
NombreNew varchar(45),aPaternoNew varchar(45),aMaternoNew varchar(45),RfcNew varchar(45),DireccionNew varchar(45),TelefonoNew bigint,FechaNacimientoNew date,SexoNew char,
Usuario varchar(45),Modificado datetime,Accion varchar(45),idClientes int);
******
create table Audi_Factura(id int primary key auto_increment,
FechaPagoAnt date,TipoPagoAnt varchar(45),
FechaPagoNew date,TipoPagoNew varchar(45),
Usuario varchar(45),Modificado datetime,Accion varchar(45),idFactura int);
*******
create table Audi_Ventas(id int primary key auto_increment,
id_ProductosAnt int,id_ClientesAnt int,id_FacturaAnt int,MontoAnt double,FechaVentaAnt date,
id_ProductosNew int,id_ClientesNew int,id_FacturaNew int,MontoNew double,FechaVentaNew date,
Usuario varchar(45),Modificado datetime,Accion varchar(45),idVentas int);

//**Mostrar Tablas**//

show tables;

desc Representante;
desc Audi_Representante;
desc Empresa;
desc Audi_Empresa;
desc Provedor;
desc Audi_Provedor;
desc Productos;
desc Audi_Productos;
desc Clientes;
desc Audi_Clientes;
desc Factura;
desc Audi_Factura;
desc Ventas;
desc Audi_Ventas;

//**Triggers de Audi_Representante**//

//Actualizar
create trigger ActualizarRepresentante after update on Representante for each row insert into Audi_Representante(
NombreAnt,aPaternoAnt,TelefonoAnt,EmailAnt,CargoAnt,
NombreNew,aPaternoNew,TelefonoNew,EmailNew,CargoNew,
Usuario,Modificado,Accion,idRepresentante) values(
old.Nombre,old.aPaterno,old.Telefono,old.Email,old.Cargo,
new.Nombre,new.aPaterno,new.Telefono,new.Email,new.Cargo,
user(),now(),'Modificado',new.idRepresentante);

//Insertar
create trigger AgregarRepresentante after insert on Representante for each row insert into Audi_Representante(
NombreNew,aPaternoNew,TelefonoNew,EmailNew,CargoNew,
Usuario,Modificado,Accion,idRepresentante)
values(new.Nombre,new.aPaterno,new.Telefono,new.Email,new.Cargo,
user(),now(),'Agregado',new.idRepresentante);

//Eliminar
create trigger EliminarRepresentante after delete on Representante for each row insert into Audi_Representante(
NombreAnt,aPaternoAnt,TelefonoAnt,EmailAnt,CargoAnt,
Usuario,Modificado,Accion,idRepresentante)
values(old.Nombre,old.aPaterno,old.Telefono,old.Email,old.Cargo,
user(),now(),'Eliminado',old.idRepresentante);

//**Triggers de Audi_Empresa**//

//Actualizar//
create trigger ActualizarEmpresa after update on Empresa for each row insert into Audi_Empresa(
id_RepresentanteAnt,NombreAnt,PaisAnt,DireccionAnt,TelefonoAnt,CorreoAnt,HorarioAnt,
id_RepresentanteNew,NombreNew,PaisNew,DireccionNew,TelefonoNew,CorreoNew,HorarioNew,
Usuario,Modificado,Accion,idEmpresa) values(
old.Id_Representante,old.Nombre,old.Pais,old.Direccion,old.Telefono,old.Correo,old.Horario,
new.Id_Representante,new.Nombre,new.Pais,new.Direccion,new.Telefono,new.Correo,new.Horario,
user(),now(),'Modificado',new.idEmpresa);

//Insertar//
create trigger AgregarEmpresa after insert on Empresa for each row insert into Audi_Empresa(
id_RepresentanteNew,NombreNew,PaisNew,DireccionNew,TelefonoNew,CorreoNew,HorarioNew,
Usuario,Modificado,Accion,idEmpresa)
values(new.Id_Representante,new.Nombre,new.Pais,new.Direccion,new.Telefono,new.Correo,new.Horario,
user(),now(),'Agregado',new.idEmpresa);

//Eliminar//
create trigger EliminarEmpresa after delete on Empresa for each row insert into Audi_Empresa(
id_RepresentanteAnt,NombreAnt,PaisAnt,DireccionAnt,TelefonoAnt,CorreoAnt,HorarioAnt,
usuario,modificado,accion,idEmpresa)
values(old.Id_Representante,old.Nombre,old.Pais,old.Direccion,old.Telefono,old.Correo,old.Horario,
user(),now(),'Eliminado',old.idEmpresa);

//**Triggers  de Audi_Provedor**//

//Actualizar//

//Insertar//

//Eliminar//


//**Triggers  de Audi_Productos**//

//Actualizar//

//Insertar//

//Eliminar//


//**Triggers de Audi_Clientes**//

//Actualizar
create trigger ActualizarClientes after update on Clientes for each row insert into Audi_Clientes(
NombreAnt,aPaternoAnt,aMaternoAnt,RfcAnt,DireccionAnt,TelefonoAnt,FechaNacimientoAnt,SexoAnt,
NombreNew,aPaternoNew,aMaternoNew,RfcNew,DireccionNew,TelefonoNew,FechaNacimientoNew,SexoNew,
Usuario,Modificado,Accion,idClientes) values(
old.Nombre,old.aPaterno,old.aMaterno,old.Rfc,old.Direccion,old.Telefono,old.FechaNacimiento,old.Sexo,
new.Nombre,new.aPaterno,new.aMaterno,new.Rfc,new.Direccion,new.Telefono,new.FechaNacimiento,new.Sexo,
user(),now(),'Modificado',new.idClientes);

//Insertar
create trigger AgregarClientes after insert on Clientes for each row insert into Audi_Clientes(
NombreNew,aPaternoNew,aMaternoNew,RfcNew,DireccionNew,TelefonoNew,FechaNacimientoNew,SexoNew,
Usuario,Modificado,Accion,idClientes) values(
new.Nombre,new.aPaterno,new.aMaterno,new.Rfc,new.Direccion,new.Telefono,new.FechaNacimiento,new.Sexo,
user(),now(),'Agregado',new.idClientes);

//Eliminar
create trigger EliminarClientes after delete on Clientes for each row insert into Audi_Clientes(
NombreAnt,aPaternoAnt,aMaternoAnt,RfcAnt,DireccionAnt,TelefonoAnt,FechaNacimientoAnt,SexoAnt,
Usuario,Modificado,Accion,idClientes) values(
old.Nombre,old.aPaterno,old.aMaterno,old.Rfc,old.Direccion,old.Telefono,old.FechaNacimiento,old.Sexo,
user(),now(),'Eliminado',old.idClientes);

//**Triggers de Audi_Factura**//

//Actualizar
create trigger ActualizarFactura after update on Factura for each row insert into Audi_Factura(
FechaPagoAnt,TipoPagoAnt,
FechaPagoNew,TipoPagoNew,
Usuario,Modificado,Accion,idFactura) values(
old.FechaPago,old.TipoPago,
new.FechaPago,new.TipoPago,
user(),now(),'Modificado',new.idFactura);

//Insertar
create trigger Agregarfactura after insert on Factura for each row insert into Audi_Factura(
FechaPagoNew,TipoPagoNew,
Usuario,Modificado,Accion,idFactura) values(
new.FechaPago,new.TipoPago,
user(),now(),'Agregado',new.idFactura);

//Eliminar
create trigger EliminarFactura after delete on Factura for each row insert into Audi_Factura(
FechaPagoAnt,TipoPagoAnt,
usuario,modificado,accion,idFactura) values(
old.FechaPago,old.TipoPago,
user(),now(),'Eliminado',old.idFactura);

//**Triggers de audi_ventas**//

//Actualizar
create trigger ActualizarVentas after update on Ventas for each row insert into Audi_Ventas(
id_ProductosAnt,id_ClientesAnt,id_FacturaAnt,MontoAnt,FechaVentaAnt,
id_ProductosNew,id_ClientesNew,id_FacturaNew,MontoNew,FechaVentaNew,
Usuario,Modificado,Accion,idVentas) values(
old.id_Productos,old.id_clientes,old.id_Factura,old.Monto,old.FechaVenta,
new.id_Productos,new.id_clientes,new.id_Factura,new.Monto,new.FechaVenta,
user(),now(),'Modificado',new.idVentas);

//Insertar
create trigger AgregarVentas after insert on Ventas for each row insert into Audi_Ventas(
id_ProductosNew,id_ClientesNew,id_FacturaNew,MontoNew,FechaVentaNew,
Usuario,Modificado,Accion,idVentas) values(
new.id_Productos,new.id_clientes,new.id_Factura,new.Monto,new.FechaVenta,
user(),now(),'Agregado',new.idVentas);

//Eliminar
create trigger EliminarVentas after delete on Ventas for each row insert into Audi_Ventas(
id_ProductosAnt,id_ClientesAnt,id_FacturaAnt,MontoAnt,FechaVentaAnt,
usuario,modificado,accion,idVentas) values(
old.id_Productos,old.id_clientes,old.id_Factura,old.Monto,old.FechaVenta,
user(),now(),'Eliminado',old.idVentas);

//**Insertar Datos**//

insert into Representante   values
('1','Salvador','Robles','5511223344','SARO@gmail.com','Gerente'),
('2','Israel','Ramirez','5511223344','ISRA@gmail.com','Encargado'),
('3','Joaquin','Cruz','5511223344','JOCR@gmail.com','Relaciones Publicas');
insert into Empresa         values
('1','1','Bimbo','Mexico','CDMX','5511223344','Bimbo@Bimbo.com','Matutino'),
('2','2','Sabritas','Mexico','CDMX','5511223344','Sabritas@Sabritas.com','Vespertino'),
('3','3','Coca-Cola','Mexico','CDMX','5511223344','Coca-Cola@CocaCola.com','Nocturno');
insert into Provedor        values
('','','','','','','','','',''),
('','','','','','','','','',''),
('','','','','','','','','','');
insert into Productos       values
('','','','','','',''),
('','','','','','',''),
('','','','','','','');
insert into Clientes        values
('','','','','','','','',''),
('','','','','','','','',''),
('','','','','','','','','');
insert into Factura         values
('','',''),
('','',''),
('','','');
insert into Ventas          values
('','','','','',''),
('','','','','',''),
('','','','','','');

//**Mostrar Tablas Auditoria**//

select * from Audi_Representante;
select * from Audi_Empresa;
select * from Audi_Provedor;
select * from Audi_Productos;
select * from Audi_Clientes;
select * from Audi_Factura;
select * from Audi_Ventas;